<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portes, Mudanzas y Vaciados en Sevilla</title>
  <style>
    :root{
      --primary:#007BFF;
      --accent:#25D366;
      --muted:#f4f4f4;
      --card:#ffffff;
      --text:#222;
      --sub:#555;
    }
    html, body { margin:0; padding:0; overflow-x:hidden; font-family: Arial, sans-serif; background:var(--muted); color:var(--text); }
    *, *:before, *:after { box-sizing: border-box; }
    .container { max-width: 900px; width: 95%; margin: 18px auto; background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); }
    h1, h2 { text-align:center; margin: 10px 0 12px; }
    p { line-height: 1.5; }
    ul { font-size:16px; line-height:1.6; margin:0 0 14px; padding-left:18px; }
    table { width:100%; border-collapse: collapse; font-size:16px; margin:10px 0 20px; border-radius:10px; overflow:hidden; }
    table th, table td { padding:10px; text-align:center; }
    thead th { background:#f0f4ff; }
    tbody tr:nth-child(odd){ background:#fafafa;}
    input, textarea { width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; font-size:15px; background:#fff; }
    label { display:block; margin-bottom: 10px; font-size:15px; }
    .check { display:flex; align-items:center; gap:10px; margin:6px 0; }
    .check input[type="checkbox"]{ width:18px; height:18px; }
    .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .grid-3 { display:grid; grid-template-columns: repeat(3,1fr); gap:12px; }
    .grid-3 label, .grid-2 label { background:#fafafa; border:1px solid #eee; border-radius:10px; padding:10px; }
    button { background:var(--primary); color:#fff; padding:12px 16px; border:none; border-radius:8px; cursor:pointer; font-size:16px; width:100%; transition: filter .2s; }
    button:hover { filter:brightness(.95); }
    .btn-wa { background:var(--accent); display:inline-block; text-decoration:none; text-align:center; padding:12px 16px; border-radius:8px; color:#fff; }
    #resultado { font-size:16px; font-weight:600; color:#0a7a24; margin-top:8px; text-align:center; }
    .kpis { display:grid; grid-template-columns: 1fr; gap:8px; margin:12px 0 10px; }
    .kpi { text-align:center; padding:10px; background:#f9fbff; border:1px solid #eaf1ff; border-radius:10px; font-weight:700; color:var(--primary); }
    #map { height: 360px; width: 100%; border-radius: 12px; margin-bottom: 8px; }
    #map-instruction { font-size: 15px; color: var(--sub); text-align: center; margin-bottom: 10px; }
    .legend { font-size:13px; color:#333; text-align:center; margin-bottom:14px; }
    .aviso { font-size:16px; color:#b55a00; font-weight:700; text-align:center; margin:8px 0 18px; }
    .aviso span { color:#0e8f3a; }
    .banner { background:#ffe9b3; padding:16px; border-radius:10px; margin:18px 0; text-align:center; font-size:18px; font-weight:bold; color:#4b4b4b; border:1px dashed #f2c66d; }
    .banner span { color:#c0392b; }
    .cards { display:grid; grid-template-columns: 1fr; gap:14px; margin: 12px 0 6px; }
    .card { border:1px solid #eee; border-radius:12px; overflow:hidden; background:#fff; display:grid; grid-template-columns: 110px 1fr; gap:12px; align-items:center; }
    .card img { width:110px; height:100%; object-fit:cover; display:block; }
    .card-body { padding:10px 12px; }
    .card-title { font-weight:700; margin:0 0 6px; }
    .card-text { margin:0; color:#444; font-size:14px; }
    .badge { display:inline-block; background:#eaf8ec; color:#0e8f3a; border:1px solid #cdeed2; padding:4px 8px; border-radius:999px; font-size:12px; margin-top:6px;}
    .cta-inline { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:14px; }
    .muted { color:#777; font-size:14px; text-align:center; margin:6px 0 0; }
    .desglose { font-size:13px; color:#555; text-align:center; margin:6px 0 0; }

    /* Footer */
    footer { background:#0d1b2a; color:#fff; margin-top:24px; padding:22px 0 28px; }
    .footer-inner { max-width:900px; width:95%; margin:0 auto; display:grid; gap:16px; }
    .foot-grid { display:grid; grid-template-columns: 1fr; gap:16px; }
    .foot-col h4 { margin:0 0 8px; font-size:16px; }
    .foot-col p, .foot-col a { font-size:14px; color:#e6f1ff; text-decoration:none; }
    .foot-col a:hover { text-decoration:underline; }
    .foot-cta { display:flex; gap:10px; flex-wrap:wrap; }
    .foot-cta a { background:#25D366; color:#0d1b2a; padding:10px 14px; border-radius:8px; font-weight:700; text-decoration:none; }
    .copy { text-align:center; font-size:12px; color:#bcd1ff; margin-top:6px; }

    /* Modal */
    #modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; }
    .modal-box { background:#fff; padding:20px; border-radius:8px; max-width:300px; text-align:center; box-shadow:0 10px 30px rgba(0,0,0,0.25); }

    @media (min-width:560px){
      .kpis{ grid-template-columns: repeat(3,1fr); }
      .cards{ grid-template-columns: 1fr 1fr; }
      .grid-3{ grid-template-columns: repeat(3,1fr); }
      .foot-grid{ grid-template-columns: 1fr 1fr 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöö Portes, Mudanzas y Vaciados en Sevilla</h1>
    <p style="text-align:center">Servicio r√°pido, profesional y econ√≥mico en Sevilla y alrededores.</p>

    <p class="aviso">‚ö†Ô∏è Si hay objetos de valor, el vaciado puede salir <span>GRATIS</span> a cambio del contenido.</p>

    <div class="banner">
      üçÇ ¬°Antes del invierno! Impermeabiliza tu azotea o terraza. <br>
      <span>No dejes que la humedad te sorprenda.</span>
    </div>

    <h2>üìã Servicios</h2>
    <ul>
      <li>‚úÖ Portes econ√≥micos (solo transporte o con ayuda a pie de calle)</li>
      <li>‚úÖ Mudanzas completas con carga y descarga</li>
      <li>‚úÖ Vaciado de pisos, naves y trasteros</li>
      <li>‚úÖ Transporte de muebles y electrodom√©sticos</li>
      <li>‚úÖ Limpieza post-vaciado</li>
      <li>‚úÖ Pintura e impermeabilizaci√≥n</li>
    </ul>

    <h2>üé® Pintura e Impermeabilizaci√≥n</h2>
    <div class="cards">
      <!-- IM√ÅGENES "ESTILO IA" QUE SIEMPRE CARGAN -->
      <div class="card">
        <img alt="Impermeabilizaci√≥n de azotea"
             src="data:image/svg+xml;utf8,
<svg xmlns='http://www.w3.org/2000/svg' width='300' height='200'>
  <defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
    <stop offset='0%' stop-color='%23007BFF'/><stop offset='100%' stop-color='%2346A2FF'/>
  </linearGradient></defs>
  <rect width='100%%' height='100%%' fill='url(%23g)'/>
  <g fill='%23fff' font-family='Arial' font-size='18' font-weight='700'>
    <text x='16' y='36'>IMPERMEABILIZACI√ìN</text>
    <text x='16' y='64'>DE AZOTEA</text>
  </g>
  <g stroke='%23fff' stroke-width='4' fill='none'>
    <path d='M30,150 L270,150'/>
    <path d='M50,80 L150,40 L250,80 L250,150 L50,150 Z'/>
    <path d='M90,150 C110,130 130,130 150,150 C170,170 190,170 210,150'/>
  </g>
</svg>"/>
        <div class="card-body">
          <p class="card-title">Impermeabilizaci√≥n de Azoteas</p>
          <p class="card-text">Sellado de juntas, l√°mina l√≠quida y reparaciones. Trabajo garantizado.</p>
          <span class="badge">Antes del invierno</span>
        </div>
      </div>
      <div class="card">
        <img alt="Pintura de vivienda"
             src="data:image/svg+xml;utf8,
<svg xmlns='http://www.w3.org/2000/svg' width='300' height='200'>
  <rect width='100%%' height='100%%' fill='%23f39c12'/>
  <g fill='%23fff' font-family='Arial' font-size='18' font-weight='700'>
    <text x='16' y='36'>PINTURA</text>
    <text x='16' y='64'>DE VIVIENDA</text>
  </g>
  <g stroke='%23fff' stroke-width='5' fill='none'>
    <rect x='180' y='40' width='80' height='80' rx='6'/>
    <path d='M40,160 L260,160'/>
    <path d='M60,120 L140,120'/>
  </g>
  <g fill='%23fff'>
    <rect x='60' y='90' width='16' height='46' rx='3'/>
    <rect x='54' y='136' width='28' height='10' rx='3'/>
  </g>
</svg>"/>
        <div class="card-body">
          <p class="card-title">Pintura de Viviendas</p>
          <p class="card-text">Pisos, trasteros y naves. Acabado limpio y r√°pido.</p>
          <span class="badge">Presupuesto sin compromiso</span>
        </div>
      </div>
      <div class="card">
        <img alt="Pintura de naves y suelos epoxi"
             src="data:image/svg+xml;utf8,
<svg xmlns='http://www.w3.org/2000/svg' width='300' height='200'>
  <rect width='100%%' height='100%%' fill='%2327ae60'/>
  <g fill='%23fff' font-family='Arial' font-size='18' font-weight='700'>
    <text x='16' y='36'>PINTURA DE NAVE</text>
    <text x='16' y='64'>SUELO EPOXI</text>
  </g>
  <g stroke='%23fff' stroke-width='4' fill='none'>
    <rect x='30' y='90' width='240' height='70' rx='4'/>
    <path d='M30,120 L270,120'/>
    <path d='M60,160 L120,100 L180,160 L240,100'/>
  </g>
</svg>"/>
        <div class="card-body">
          <p class="card-title">Pintura de Naves</p>
          <p class="card-text">Suelos epoxi, paredes y techos. Protecci√≥n y est√©tica.</p>
          <span class="badge">Profesional</span>
        </div>
      </div>
      <div class="card">
        <img alt="Sellado y humedades"
             src="data:image/svg+xml;utf8,
<svg xmlns='http://www.w3.org/2000/svg' width='300' height='200'>
  <rect width='100%%' height='100%%' fill='%239b59b6'/>
  <g fill='%23fff' font-family='Arial' font-size='18' font-weight='700'>
    <text x='16' y='36'>SELLADO</text>
    <text x='16' y='64'>Y HUMEDADES</text>
  </g>
  <g stroke='%23fff' stroke-width='4' fill='none'>
    <path d='M40,150 C80,110 120,190 160,150 C200,110 240,190 260,150'/>
    <circle cx='220' cy='110' r='14'/>
    <path d='M220,96 L220,70'/>
  </g>
</svg>"/>
        <div class="card-body">
          <p class="card-title">Sellado y Humedades</p>
          <p class="card-text">Tratamiento de filtraciones y grietas. Soluciones duraderas.</p>
          <span class="badge">Garant√≠a</span>
        </div>
      </div>
    </div>

    <div class="cta-inline">
      <a href="https://wa.me/34698373471" class="btn-wa">üí¨ Pide tu presupuesto de pintura</a>
    </div>
    <p class="muted">Atendemos Sevilla y alrededores.</p>

    <h2>üìç Marca tu ruta en el mapa</h2>
    <div id="map"></div>
    <p id="map-instruction">Toca en el mapa o escribe direcciones para marcar origen y destino.</p>
    <p class="legend">Zona azul = <strong>Sevilla Capital (tarifa reducida)</strong>. Km a 0,9 ‚Ç¨/km dentro del c√≠rculo, 1,2 ‚Ç¨/km fuera.</p>

    <h2>üí¨ Calcula tu presupuesto</h2>
    <div style="border:1px solid #eaeaea; padding:15px; border-radius:12px;">
      <div class="grid-2">
        <label>Nombre completo
          <input type="text" id="nombre" placeholder="Tu nombre"/>
        </label>
        <label>N√∫mero WhatsApp
          <input type="tel" id="telefono" placeholder="Ej: 698373471"/>
        </label>
      </div>

      <!-- NIVELES (no se suman entre s√≠, el script usa la jerarqu√≠a) -->
      <label class="check"><input type="checkbox" class="option" data-name="Porte local (ayuda pie de calle)" data-price="0"> Porte local (ayuda a pie de calle incluida)</label>
      <label class="check"><input type="checkbox" class="option" data-name="Carga y descarga adicional" data-price="0"> Porte + Carga y descarga</label>
      <label class="check"><input type="checkbox" class="option" data-name="Mudanza peque√±a" data-price="0"> Mudanza peque√±a</label>
      <label class="check"><input type="checkbox" class="option" data-name="Mudanza completa" data-price="0"> Mudanza completa</label>

      <!-- EXTRAS -->
      <label class="check"><input type="checkbox" class="option" data-name="Vaciado de piso" data-price="150"> Vaciado de piso</label>
      <label class="check"><input type="checkbox" class="option" data-name="Vaciado de nave" data-price="180"> Vaciado de nave</label>
      <label class="check"><input type="checkbox" class="option" data-name="Pintura/impermeabilizaci√≥n" data-price="0"> Pintura o impermeabilizaci√≥n</label>

      <h3>üì¶ Objetos</h3>
      <div class="grid-3">
        <label>Armarios
          <input type="number" id="armarios" min="0" value="0">
        </label>
        <label>Cajas
          <input type="number" id="cajas" min="0" value="0">
        </label>
        <label>Bultos
          <input type="number" id="bultos" min="0" value="0">
        </label>
        <label>Sof√°s
          <input type="number" id="sofas" min="0" value="0">
        </label>
        <label>Cama matrimonio
          <input type="number" id="camaMatrimonio" min="0" value="0">
        </label>
        <label>Cama individual
          <input type="number" id="camaIndividual" min="0" value="0">
        </label>
      </div>

      <label>Otros objetos
        <input type="text" id="otros-objetos" placeholder="Ej: mesas, sillas...">
      </label>

      <div class="grid-2">
        <label>Peso total manual (kg)
          <input type="number" id="pesoManual" placeholder="Introduce peso si lo sabes">
        </label>
        <label>Notas
          <input type="text" id="notas" placeholder="Ascensor, 2¬™ planta, franja horaria...">
        </label>
      </div>

      <div class="grid-2">
        <label>Direcci√≥n origen
          <input type="text" id="origen" placeholder="Marca en mapa o escribe">
        </label>
        <label>Direcci√≥n destino
          <input type="text" id="destino" placeholder="Marca en mapa o escribe">
        </label>
      </div>

      <div class="kpis">
        <div id="precioTotal" class="kpi">Precio estimado: 0 ‚Ç¨</div>
        <div id="distanciaRuta" class="kpi">Distancia de la ruta: 0.0 km</div>
        <div id="pesoTotal" class="kpi">Peso estimado: 0 kg</div>
      </div>
      <p id="desglose" class="desglose"></p>

      <button onclick="enviarSolicitud()">Solicitar Presupuesto</button>
      <p id="resultado"></p>
      <p class="muted">‚ö†Ô∏è El precio mostrado es estimado. El precio final se confirma en el presupuesto oficial seg√∫n tiempo de carga/descarga y peso/volumen.</p>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-inner">
      <div class="foot-grid">
        <div class="foot-col">
          <h4>Contacto</h4>
          <p>üìû <a href="https://wa.me/34698373471">WhatsApp: 698 373 471</a></p>
          <p>üìß <a href="mailto:portemudanzayvaciadoprosevilla@gmail.com">portemudanzayvaciadoprosevilla@gmail.com</a></p>
          <p>üì∑ <a href="https://www.instagram.com/portemudanzayvaciadoprosevilla" target="_blank">@portemudanzayvaciadoprosevilla</a></p>
        </div>
        <div class="foot-col">
          <h4>Horario</h4>
          <p>Lunes a S√°bado ¬∑ 8:00‚Äì21:00</p>
          <p>Domingos y urgencias: consultar</p>
        </div>
        <div class="foot-col">
          <h4>Zonas</h4>
          <p>Sevilla Capital, Aljarafe, Dos Hermanas, Alcal√° de Guada√≠ra, San Jos√©, Camas‚Ä¶</p>
          <div class="foot-cta"><a href="https://wa.me/34698373471">üí¨ Escr√≠benos por WhatsApp</a></div>
        </div>
      </div>
      <p class="copy">¬© 2025 Porte, Mudanza y Vaciado Pro ¬∑ Sevilla</p>
    </div>
  </footer>

  <!-- Modal confirmaci√≥n -->
  <div id="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000;">
    <div class="modal-box">
      <p style="margin:0 0 8px; font-size:16px;">‚úÖ Solicitud enviada correctamente. Revisa tu WhatsApp.</p>
      <button onclick="cerrarModal()" style="padding:8px 16px; background:#007BFF; color:#fff; border:none; border-radius:5px; cursor:pointer; margin-top:10px;">Cerrar</button>
    </div>
  </div>

  <script>
let map, originMarker, destinationMarker, geocoder, directionsService, directionsRenderer, sevillaCircle;
window.distanciaKm = 0;

const SEVILLA_CENTER = { lat: 37.3980, lng: -5.9650 };
const SEVILLA_RADIUS_M = 6500; // 6,5 km

// Bases por nivel (uniformes)
const BASES = {
  porte: 35,
  porte_cyd: 60,
  mudanza_peq: 90,
  mudanza_comp: 140
};

// Para pintar "desde X ‚Ç¨" al lado de cada nivel sin tocar el HTML
const NIVEL_HINTS = {
  'porte local (ayuda pie de calle)': ` (desde ${BASES.porte} ‚Ç¨)`,
  'carga y descarga': ` (desde ${BASES.porte_cyd} ‚Ç¨)`,
  'mudanza peque√±a': ` (desde ${BASES.mudanza_peq} ‚Ç¨)`,
  'mudanza completa': ` (desde ${BASES.mudanza_comp} ‚Ç¨)`
};

function initMap() {
  map = new google.maps.Map(document.getElementById("map"), { center: SEVILLA_CENTER, zoom: 12 });
  geocoder = new google.maps.Geocoder();
  directionsService = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer({ map: map });

  // C√≠rculo Sevilla Capital (tarifa reducida)
  sevillaCircle = new google.maps.Circle({
    strokeColor: '#007BFF', strokeOpacity: 0.8, strokeWeight: 2,
    fillColor: '#007BFF', fillOpacity: 0.15, map, center: SEVILLA_CENTER,
    radius: SEVILLA_RADIUS_M, clickable: false
  });

  // Click en mapa: A -> B -> reset
  map.addListener("click", (e) => {
    if (!originMarker) {
      originMarker = new google.maps.Marker({ position: e.latLng, map, label: "A" });
      geocodePosition(e.latLng, "origen");
    } else if (!destinationMarker) {
      destinationMarker = new google.maps.Marker({ position: e.latLng, map, label: "B" });
      geocodePosition(e.latLng, "destino");
      calcularDistancia();
    } else {
      resetRuta();
    }
    actualizarPrecio();
  });

  // Escribir direcciones tambi√©n marca en el mapa
  document.getElementById("origen").addEventListener("change", () => geocodeAddress("origen"));
  document.getElementById("destino").addEventListener("change", () => geocodeAddress("destino"));

  // Recalcular precio al cambiar opciones
  document.querySelectorAll('.option').forEach(op => op.addEventListener('change', actualizarPrecio));

  // Recalcular peso si cambian cantidades o peso manual
  ["armarios","cajas","bultos","sofas","camaMatrimonio","camaIndividual","pesoManual"].forEach(id=>{
    const el = document.getElementById(id);
    if (el) el.addEventListener('input', actualizarPrecio);
  });

  // Pinta hints "(desde X ‚Ç¨)" al lado de cada nivel
  pintarHintsNiveles();
}

function pintarHintsNiveles(){
  document.querySelectorAll('.option').forEach(op=>{
    const name = (op.dataset.name || '').toLowerCase();
    const label = op.closest('label');
    if (!label) return;
    for (const key in NIVEL_HINTS){
      if (name.includes(key)){
        // evita duplicados
        if (!label.querySelector('.nivel-hint')){
          const s = document.createElement('span');
          s.className = 'nivel-hint';
          s.style.color = '#555';
          s.style.fontSize = '13px';
          s.textContent = NIVEL_HINTS[key];
          label.appendChild(s);
        }
      }
    }
  });
}

function geocodePosition(latlng, inputId) {
  geocoder.geocode({ location: latlng }, (results, status) => {
    if (status === "OK" && results[0]) {
      document.getElementById(inputId).value = results[0].formatted_address;
    }
  });
}

function geocodeAddress(inputId) {
  const address = document.getElementById(inputId).value;
  if (!address) return;
  geocoder.geocode({ address }, (results, status) => {
    if (status === "OK" && results[0]) {
      if (inputId === "origen") {
        if (originMarker) originMarker.setMap(null);
        originMarker = new google.maps.Marker({ position: results[0].geometry.location, map, label: "A" });
      } else {
        if (destinationMarker) destinationMarker.setMap(null);
        destinationMarker = new google.maps.Marker({ position: results[0].geometry.location, map, label: "B" });
      }
      map.setCenter(results[0].geometry.location);
      if (originMarker && destinationMarker) calcularDistancia();
      actualizarPrecio();
    }
  });
}

function insideSevilla(latLng){
  const center = new google.maps.LatLng(SEVILLA_CENTER.lat, SEVILLA_CENTER.lng);
  const dist = google.maps.geometry.spherical.computeDistanceBetween(latLng, center);
  return dist <= SEVILLA_RADIUS_M;
}

function calcularDistancia() {
  if (!originMarker || !destinationMarker) return;
  const request = {
    origin: originMarker.getPosition(),
    destination: destinationMarker.getPosition(),
    travelMode: google.maps.TravelMode.DRIVING
  };
  directionsService.route(request, (result, status) => {
    if (status === "OK") {
      directionsRenderer.setDirections(result);
      const ruta = result.routes[0];
      const distanciaMetros = ruta.legs[0].distance.value;
      window.distanciaKm = distanciaMetros / 1000;
      document.getElementById("distanciaRuta").textContent = `Distancia de la ruta: ${window.distanciaKm.toFixed(1)} km`;
      actualizarPrecio();
    } else {
      // Fallback: distancia en l√≠nea recta (aprox.)
      const a = originMarker.getPosition();
      const b = destinationMarker.getPosition();
      const straight = google.maps.geometry.spherical.computeDistanceBetween(a, b) / 1000;
      window.distanciaKm = straight;
      document.getElementById("distanciaRuta").textContent = `Distancia (aprox.): ${window.distanciaKm.toFixed(1)} km`;
      actualizarPrecio();
    }
  });
}

function resetRuta(){
  if (originMarker) originMarker.setMap(null);
  if (destinationMarker) destinationMarker.setMap(null);
  originMarker = null; destinationMarker = null;
  directionsRenderer.setDirections({ routes: [] });
  document.getElementById("origen").value = "";
  document.getElementById("destino").value = "";
  window.distanciaKm = 0;
  document.getElementById("distanciaRuta").textContent = "Distancia de la ruta: 0.0 km";
  actualizarPrecio();
}

/* ===== L√ìGICA DE NIVELES ===== */
function hasOption(substr){
  substr = (substr||"").toLowerCase();
  return Array.from(document.querySelectorAll('.option')).some(op=>{
    const n=(op.dataset.name||"").toLowerCase();
    return op.checked && n.includes(substr);
  });
}

function getTier(){
  const porte     = hasOption('porte local');
  const carga     = hasOption('carga y descarga');
  const mudPeq    = hasOption('mudanza peque√±a');
  const mudComp   = hasOption('mudanza completa');

  // Prioridad: mudanza completa > mudanza peque√±a > porte + C/D > porte
  if (mudComp) return 'mudanza_comp';
  if (mudPeq)   return 'mudanza_peq';
  if (porte && carga) return 'porte_cyd';
  if (porte)    return 'porte';
  return null;
}

/* ===== PESO ===== */
function calcularPeso() {
  const n = id => parseInt(document.getElementById(id)?.value) || 0;
  const manual = parseInt(document.getElementById('pesoManual')?.value) || 0;
  if (manual > 0) return manual;
  // Pesos estimados por unidad
  return n('armarios')*60 + n('cajas')*15 + n('bultos')*20 + n('sofas')*50 + n('camaMatrimonio')*80 + n('camaIndividual')*50;
}

function recargoPorPeso(peso, tier){
  // Solo suma si NO es porte simple
  if (!(tier==='porte_cyd' || tier==='mudanza_peq' || tier==='mudanza_comp')) return 0;
  if (peso <= 200) return 0;
  if (peso <= 500) return 20;
  if (peso <= 800) return 40;
  return 60; // >800 kg
}

// Pe√≥n por objetos pesados: 1 pe√≥n si >=1 pesado; 2 peones si >=3 pesados
function peonPorObjetos(tier){
  if (!(tier==='porte_cyd' || tier==='mudanza_peq' || tier==='mudanza_comp')) return 0;
  const n = id => parseInt(document.getElementById(id)?.value) || 0;
  const pesados = n('sofas') + n('armarios') + n('camaMatrimonio');
  if (pesados >= 3) return 50;     // 2 peones sugeridos
  if (pesados >= 1) return 25;     // 1 pe√≥n sugerido
  return 0;
}

/* ===== PRECIO TOTAL ===== */
function actualizarPrecio() {
  const tier = getTier();
  const peso = calcularPeso();

  // Base por nivel (no sumamos niveles entre s√≠)
  let base = 0;
  if (tier) base = BASES[tier];

  // Extras (vaciados/pintura) s√≠ suman
  let extras = 0;
  document.querySelectorAll('.option').forEach(op=>{
    if (!op.checked) return;
    const name = (op.dataset.name||"").toLowerCase();
    const isTier = name.includes('porte local') || name.includes('carga y descarga') || name.includes('mudanza peque√±a') || name.includes('mudanza completa');
    if (!isTier) extras += parseFloat(op.dataset.price) || 0;
  });

  // Km
  let kmRate = 1.2, ambasDentro = false;
  if (originMarker && destinationMarker) {
    const dentroA = insideSevilla(originMarker.getPosition());
    const dentroB = insideSevilla(destinationMarker.getPosition());
    ambasDentro = dentroA && dentroB;
    if (ambasDentro) kmRate = 0.9;
  }
  const kmCost = (window.distanciaKm>0) ? window.distanciaKm*kmRate : 0;

  // Peso (solo si C/D o mudanza)
  const pesoCost = recargoPorPeso(peso, tier);

  // Pe√≥n sugerido por objetos pesados
  const peonAuto = peonPorObjetos(tier);

  let total = base + extras + kmCost + pesoCost + peonAuto;

  // M√≠nimo 35 ‚Ç¨ si ambas direcciones dentro de Sevilla y el nivel es porte
  if (tier==='porte' && ambasDentro && total < 35) total = 35;

  // UI
  const pesoEl = document.getElementById("pesoTotal");
  if (pesoEl) pesoEl.textContent = `Peso estimado: ${peso} kg`;
  const precioEl = document.getElementById("precioTotal");
  if (precioEl) precioEl.textContent = `Precio estimado: ${total.toFixed(2)} ‚Ç¨`;
  const desg = document.getElementById("desglose");
  if (desg) {
    const tierTxt = tier ? tier.replace('_',' ').toUpperCase() : 'sin seleccionar';
    const partes = [
      `Nivel: ${tierTxt} (${base.toFixed(2)} ‚Ç¨)`,
      `Extras: ${extras.toFixed(2)} ‚Ç¨`,
      `Km (${kmRate.toFixed(1)} ‚Ç¨/km): ${kmCost.toFixed(2)} ‚Ç¨`,
    ];
    if (pesoCost>0) partes.push(`Peso: ${pesoCost.toFixed(2)} ‚Ç¨`);
    if (peonAuto>0) partes.push(`Pe√≥n sugerido: ${peonAuto.toFixed(2)} ‚Ç¨`);
    if (ambasDentro) partes.push(`Tarifa Sevilla capital`);
    desg.textContent = partes.join(" ¬∑ ");
  }
}

/* ===== ENV√çO WHATSAPP + MODAL ===== */
function enviarSolicitud() {
  const nombre = document.getElementById('nombre')?.value.trim();
  const telefono = document.getElementById('telefono')?.value.trim();
  const origen = document.getElementById('origen')?.value.trim();
  const destino = document.getElementById('destino')?.value.trim();
  const notas = document.getElementById('notas')?.value.trim();

  if (!nombre || !telefono || !origen || !destino) {
    alert("Por favor, completa nombre, WhatsApp, origen y destino.");
    return;
  }
  const precio = document.getElementById('precioTotal')?.textContent || '';
  const peso = document.getElementById('pesoTotal')?.textContent || '';
  const distancia = document.getElementById('distanciaRuta')?.textContent || '';

  let mensaje = `Presupuesto pedido por ${nombre}%0A`;
  mensaje += `Tel√©fono: ${telefono}%0A`;
  mensaje += `Origen: ${origen}%0ADestino: ${destino}%0A`;
  mensaje += `${distancia}%0A${peso}%0A${precio}%0A`;
  mensaje += `Notas: ${notas || 'Ninguna'}%0A`;

  const numeroWhatsApp = '34698373471';
  const urlWhatsapp = `https://wa.me/${numeroWhatsApp}?text=${mensaje}`;
  window.open(urlWhatsapp, '_blank');

  abrirModal();
}

function abrirModal(){ const m=document.getElementById('modal'); if(!m) return; m.style.display='flex'; m.setAttribute('aria-hidden','false'); }
function cerrarModal(){ const m=document.getElementById('modal'); if(!m) return; m.style.display='none'; m.setAttribute('aria-hidden','true'); }
document.addEventListener('keydown', e=>{ if(e.key==='Escape') cerrarModal(); });
document.addEventListener('click', e=>{ const m=document.getElementById('modal'); if(!m||m.style.display==='none') return; if(e.target===m) cerrarModal(); });
</script>


  <!-- Google Maps API (incluye geometry para el c√≠rculo y la distancia) -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDVPHqQDXL4vVijvq2vg3KeGKwgR-VDgu8&libraries=geometry&callback=initMap" async defer></script>
</body>
</html>

