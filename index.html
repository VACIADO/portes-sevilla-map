<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Portes, Mudanzas y Vaciados en Sevilla</title>
  <style>
    :root{
      --primary:#007BFF;
      --accent:#25D366;
      --muted:#f4f4f4;
      --card:#ffffff;
      --text:#222;
      --sub:#555;
      --line:#eee;
    }
    html, body { margin:0; padding:0; overflow-x:hidden; font-family: Arial, sans-serif; background:var(--muted); color:var(--text); }
    *, *:before, *:after { box-sizing: border-box; }
    .container { max-width: 900px; width: 95%; margin: 18px auto; background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); }
    h1, h2 { text-align:center; margin: 10px 0 12px; }
    p { line-height: 1.5; }

    /* Lista de servicios con precios a la derecha (arriba) */
    .services { list-style:none; padding:0; margin:0; border:1px solid var(--line); border-radius:10px; overflow:hidden; }
    .services li { display:flex; justify-content:space-between; align-items:center; padding:10px 12px; border-bottom:1px dashed var(--line); font-size:16px; background:#fff; }
    .services li:last-child{ border-bottom:none; }
    .tag-price { color:#111; font-weight:700; font-size:14px; margin-left:20px; opacity:.95; }

    /* Inputs y layout form */
    input, textarea { width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; font-size:15px; background:#fff; }
    label { display:block; margin-bottom: 10px; font-size:15px; }
    .check { display:flex; align-items:center; gap:10px; margin:6px 0; }
    .check input[type="checkbox"]{ width:18px; height:18px; }
    .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }

    /* ‚úÖ Objetos en 2 columnas fijas (m√≥vil y escritorio) */
    .grid-obj {
      display:grid;
      grid-template-columns: repeat(2,1fr);
      gap:12px;
    }
    .grid-obj label, .grid-2 label { background:#fafafa; border:1px solid #eee; border-radius:10px; padding:10px; }

    button { background:var(--primary); color:#fff; padding:12px 16px; border:none; border-radius:8px; cursor:pointer; font-size:16px; width:100%; transition: filter .2s; }
    button:hover { filter:brightness(.95); }
    .btn-wa { background:var(--accent); display:inline-block; text-decoration:none; text-align:center; padding:12px 16px; border-radius:8px; color:#fff; }
    #resultado { font-size:16px; font-weight:600; color:#0a7a24; margin-top:8px; text-align:center; }
    .kpis { display:grid; grid-template-columns: 1fr; gap:8px; margin:12px 0 10px; }
    .kpi { text-align:center; padding:10px; background:#f9fbff; border:1px solid #eaf1ff; border-radius:10px; font-weight:700; color:var(--primary); }
    #map { height: 360px; width: 100%; border-radius: 12px; margin-bottom: 8px; }
    #map-instruction { font-size: 15px; color: var(--sub); text-align: center; margin-bottom: 10px; }
    .legend { font-size:13px; color:#333; text-align:center; margin-bottom:14px; }
    .aviso { font-size:16px; color:#b55a00; font-weight:700; text-align:center; margin:8px 0 18px; }
    .aviso span { color:#0e8f3a; }
    .banner { background:#ffe9b3; padding:16px; border-radius:10px; margin:18px 0; text-align:center; font-size:18px; font-weight:bold; color:#4b4b4b; border:1px dashed #f2c66d; }
    .banner span { color:#c0392b; }
    .muted { color:#777; font-size:14px; text-align:center; margin:6px 0 0; }
    .desglose { font-size:13px; color:#555; text-align:center; margin:6px 0 0; }

    /* Footer */
    footer { background:#0d1b2a; color:#fff; margin-top:24px; padding:22px 0 28px; }
    .footer-inner { max-width:900px; width:95%; margin:0 auto; display:grid; gap:16px; }
    .foot-grid { display:grid; grid-template-columns: 1fr; gap:16px; }
    .foot-col h4 { margin:0 0 8px; font-size:16px; }
    .foot-col p, .foot-col a { font-size:14px; color:#e6f1ff; text-decoration:none; }
    .foot-col a:hover { text-decoration:underline; }
    .foot-cta { display:flex; gap:10px; flex-wrap:wrap; }
    .foot-cta a { background:#25D366; color:#0d1b2a; padding:10px 14px; border-radius:8px; font-weight:700; text-decoration:none; }
    .copy { text-align:center; font-size:12px; color:#bcd1ff; }

    /* Modal */
    #modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; }
    .modal-box { background:#fff; padding:20px; border-radius:8px; max-width:300px; text-align:center; box-shadow:0 10px 30px rgba(0,0,0,0.25); }

    @media (min-width:560px){
      .kpis{ grid-template-columns: repeat(3,1fr); }
      .cards{ grid-template-columns: 1fr 1fr; }
      .foot-grid{ grid-template-columns: 1fr 1fr 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöö Portes, Mudanzas y Vaciados en Sevilla</h1>
    <p style="text-align:center">Servicio r√°pido, profesional y econ√≥mico en Sevilla y alrededores.</p>

    <p class="aviso">‚ö†Ô∏è Si hay objetos de valor, el vaciado puede salir <span>GRATIS</span> a cambio del contenido.</p>

    <div class="banner">
      üçÇ ¬°Antes del invierno! Impermeabiliza tu azotea o terraza. <br>
      <span>No dejes que la humedad te sorprenda.</span>
    </div>

    <h2>üìã Servicios (precios orientativos)</h2>
    <ul class="services">
      <li><span>‚úÖ Porte (solo transporte, ayuda a pie de calle)</span><span class="tag-price">desde 35 ‚Ç¨</span></li>
      <li><span>‚úÖ Porte con carga y descarga</span><span class="tag-price">desde 60 ‚Ç¨</span></li>
      <li><span>‚úÖ Mudanza peque√±a</span><span class="tag-price">desde 90 ‚Ç¨</span></li>
      <li><span>‚úÖ Vaciado de piso</span><span class="tag-price">desde 150 ‚Ç¨</span></li>
      <li><span>‚úÖ Vaciado de nave</span><span class="tag-price">desde 180 ‚Ç¨</span></li>
      <li><span>‚úÖ Pintura / Impermeabilizaci√≥n</span><span class="tag-price">pide presupuesto</span></li>
    </ul>

    <h2>üìç Marca tu ruta en el mapa</h2>
    <div id="map"></div>
    <p id="map-instruction">Toca en el mapa o escribe direcciones para marcar origen y destino.</p>
    <p class="legend">Zona azul = <strong>Sevilla Capital (tarifa reducida)</strong>. Km a 0,9 ‚Ç¨/km dentro del c√≠rculo, 1,2 ‚Ç¨/km fuera.</p>

    <h2>üí¨ Calcula tu presupuesto</h2>
    <div style="border:1px solid #eaeaea; padding:15px; border-radius:12px;">
      <div class="grid-2">
        <label>Nombre completo
          <input type="text" id="nombre" placeholder="Tu nombre"/>
        </label>
        <label>N√∫mero WhatsApp
          <input type="tel" id="telefono" placeholder="Ej: 698373471"/>
        </label>
      </div>

      <!-- ‚úÖ Opciones del formulario SIN precios al lado -->
      <label class="check"><input type="checkbox" class="option" data-name="Porte (solo transporte)" data-price="35" id="optPorte"> Porte (solo transporte, ayuda a pie de calle)</label>
      <label class="check"><input type="checkbox" class="option" data-name="Porte con carga y descarga" data-price="60" id="optPorteCD"> Porte con carga y descarga</label>
      <label class="check"><input type="checkbox" class="option" data-name="Mudanza peque√±a" data-price="90" id="optMudanza"> Mudanza peque√±a</label>
      <label class="check"><input type="checkbox" class="option" data-name="Vaciado de piso" data-price="150" id="optVaciadoPiso"> Vaciado de piso</label>
      <label class="check"><input type="checkbox" class="option" data-name="Vaciado de nave" data-price="180" id="optVaciadoNave"> Vaciado de nave</label>
      <label class="check"><input type="checkbox" class="option" data-name="Pintura/impermeabilizaci√≥n" data-price="0"> Pintura o impermeabilizaci√≥n</label>

      <h3>üì¶ Objetos</h3>
      <div class="grid-obj">
        <label>Armarios
          <input type="number" id="armarios" min="0" value="0">
        </label>
        <label>Cajas
          <input type="number" id="cajas" min="0" value="0">
        </label>
        <label>Bultos
          <input type="number" id="bultos" min="0" value="0">
        </label>
        <label>Sof√°s
          <input type="number" id="sofas" min="0" value="0">
        </label>
        <label>Cama matrimonio
          <input type="number" id="camaMatrimonio" min="0" value="0">
        </label>
        <label>Cama individual
          <input type="number" id="camaIndividual" min="0" value="0">
        </label>
      </div>

      <label>Otros objetos
        <input type="text" id="otros-objetos" placeholder="Ej: mesas, sillas...">
      </label>

      <div class="grid-2">
        <label>Peso total manual (kg)
          <input type="number" id="pesoManual" placeholder="Introduce peso si lo sabes">
        </label>
        <label>Notas
          <input type="text" id="notas" placeholder="Ascensor, 2¬™ planta, franja horaria...">
        </label>
      </div>

      <div class="grid-2">
        <label>Direcci√≥n origen
          <input type="text" id="origen" placeholder="Marca en mapa o escribe">
        </label>
        <label>Direcci√≥n destino
          <input type="text" id="destino" placeholder="Marca en mapa o escribe">
        </label>
      </div>

      <div class="kpis">
        <div id="precioTotal" class="kpi">Precio estimado: 0 ‚Ç¨</div>
        <div id="distanciaRuta" class="kpi">Distancia de la ruta: 0.0 km</div>
        <div id="pesoTotal" class="kpi">Peso estimado: 0 kg</div>
      </div>
      <p id="desglose" class="desglose"></p>

      <button onclick="enviarSolicitud()">Solicitar Presupuesto</button>
      <p id="resultado"></p>
      <p class="muted">‚ö†Ô∏è El precio mostrado es estimado. El precio final se confirma en el presupuesto oficial seg√∫n tiempo de carga/descarga y peso/volumen.</p>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-inner">
      <div class="foot-grid">
        <div class="foot-col">
          <h4>Contacto</h4>
          <p>üìû <a href="https://wa.me/34698373471">WhatsApp: 698 373 471</a></p>
          <p>üìß <a href="mailto:portemudanzayvaciadoprosevilla@gmail.com">portemudanzayvaciadoprosevilla@gmail.com</a></p>
          <p>üì∑ <a href="https://www.instagram.com/portemudanzayvaciadoprosevilla" target="_blank">@portemudanzayvaciadoprosevilla</a></p>
        </div>
        <div class="foot-col">
          <h4>Horario</h4>
          <p>Lunes a S√°bado ¬∑ 8:00‚Äì21:00</p>
          <p>Domingos y urgencias: consultar</p>
        </div>
        <div class="foot-col">
          <h4>Zonas</h4>
          <p>Sevilla Capital, Aljarafe, Dos Hermanas, Alcal√° de Guada√≠ra, San Jos√©, Camas‚Ä¶</p>
          <div class="foot-cta"><a href="https://wa.me/34698373471">üí¨ Escr√≠benos por WhatsApp</a></div>
        </div>
      </div>
      <p class="copy">¬© 2025 Porte, Mudanza y Vaciado Pro ¬∑ Sevilla</p>
    </div>
  </footer>

  <!-- Modal confirmaci√≥n -->
  <div id="modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000;">
    <div class="modal-box">
      <p style="margin:0 0 8px; font-size:16px;">‚úÖ Solicitud enviada correctamente. Revisa tu WhatsApp.</p>
      <button onclick="cerrarModal()" style="padding:8px 16px; background:#007BFF; color:#fff; border:none; border-radius:5px; cursor:pointer; margin-top:10px;">Cerrar</button>
    </div>
  </div>

 <script>
let map, originMarker, destinationMarker, geocoder, directionsService, directionsRenderer, sevillaCircle;
window.distanciaKm = 0;

const SEVILLA_CENTER = { lat: 37.3980, lng: -5.9650 };
const SEVILLA_RADIUS_M = 6500; // 6,5 km

function initMap() {
  map = new google.maps.Map(document.getElementById("map"), { center: SEVILLA_CENTER, zoom: 12 });
  geocoder = new google.maps.Geocoder();
  directionsService = new google.maps.DirectionsService();
  directionsRenderer = new google.maps.DirectionsRenderer({ map: map });

  // C√≠rculo Sevilla Capital (tarifa reducida)
  sevillaCircle = new google.maps.Circle({
    strokeColor: '#007BFF', strokeOpacity: 0.8, strokeWeight: 2,
    fillColor: '#007BFF', fillOpacity: 0.15, map, center: SEVILLA_CENTER,
    radius: SEVILLA_RADIUS_M, clickable: false
  });

  // Click en mapa: A -> B -> reset
  map.addListener("click", (e) => {
    if (!originMarker) {
      originMarker = new google.maps.Marker({ position: e.latLng, map, label: "A" });
      geocodePosition(e.latLng, "origen");
    } else if (!destinationMarker) {
      destinationMarker = new google.maps.Marker({ position: e.latLng, map, label: "B" });
      geocodePosition(e.latLng, "destino");
      calcularDistancia();
    } else {
      resetRuta();
    }
    actualizarPrecio();
  });

  // Escribir direcciones tambi√©n marca en el mapa
  const o = document.getElementById("origen");
  const d = document.getElementById("destino");
  if (o) o.addEventListener("change", () => geocodeAddress("origen"));
  if (d) d.addEventListener("change", () => geocodeAddress("destino"));

  // Recalcular precio al cambiar opciones
  document.querySelectorAll('.option').forEach(op => op.addEventListener('change', actualizarPrecio));

  // Recalcular peso si cambian cantidades o peso manual
  ["armarios","cajas","bultos","sofas","camaMatrimonio","camaIndividual","pesoManual"].forEach(id=>{
    const el = document.getElementById(id);
    if (el) el.addEventListener('input', actualizarPrecio);
  });
}

function geocodePosition(latlng, inputId) {
  geocoder.geocode({ location: latlng }, (results, status) => {
    if (status === "OK" && results[0]) {
      const inp = document.getElementById(inputId);
      if (inp) inp.value = results[0].formatted_address;
    }
  });
}

function geocodeAddress(inputId) {
  const field = document.getElementById(inputId);
  if (!field) return;
  const address = field.value;
  if (!address) return;
  geocoder.geocode({ address }, (results, status) => {
    if (status === "OK" && results[0]) {
      if (inputId === "origen") {
        if (originMarker) originMarker.setMap(null);
        originMarker = new google.maps.Marker({ position: results[0].geometry.location, map, label: "A" });
      } else {
        if (destinationMarker) destinationMarker.setMap(null);
        destinationMarker = new google.maps.Marker({ position: results[0].geometry.location, map, label: "B" });
      }
      map.setCenter(results[0].geometry.location);
      if (originMarker && destinationMarker) calcularDistancia();
      actualizarPrecio();
    }
  });
}

function insideSevilla(latLng){
  const center = new google.maps.LatLng(SEVILLA_CENTER.lat, SEVILLA_CENTER.lng);
  const dist = google.maps.geometry.spherical.computeDistanceBetween(latLng, center);
  return dist <= SEVILLA_RADIUS_M;
}

function calcularDistancia() {
  if (!originMarker || !destinationMarker) return;
  const request = {
    origin: originMarker.getPosition(),
    destination: destinationMarker.getPosition(),
    travelMode: google.maps.TravelMode.DRIVING
  };
  directionsService.route(request, (result, status) => {
    if (status === "OK") {
      directionsRenderer.setDirections(result);
      const leg = result.routes[0].legs[0];
      const distanciaMetros = leg.distance.value;
      const duracionSeg = leg.duration ? leg.duration.value : 0;
      window.distanciaKm = distanciaMetros / 1000;
      const distEl = document.getElementById("distanciaRuta");
      if (distEl) distEl.textContent = `Distancia de la ruta: ${window.distanciaKm.toFixed(1)} km`;
      const durEl = document.getElementById("duracionRuta");
      if (durEl) durEl.textContent = `Duraci√≥n estimada ruta: ${Math.round(duracionSeg/60)} min`;
      actualizarPrecio();
    } else {
      // Fallback: distancia en l√≠nea recta
      const a = originMarker.getPosition();
      const b = destinationMarker.getPosition();
      const straight = google.maps.geometry.spherical.computeDistanceBetween(a, b) / 1000;
      window.distanciaKm = straight;
      const distEl = document.getElementById("distanciaRuta");
      if (distEl) distEl.textContent = `Distancia (aprox.): ${window.distanciaKm.toFixed(1)} km`;
      const durEl = document.getElementById("duracionRuta");
      if (durEl) durEl.textContent = `Duraci√≥n estimada ruta: ‚Äî`;
      actualizarPrecio();
    }
  });
}

function resetRuta(){
  if (originMarker) originMarker.setMap(null);
  if (destinationMarker) destinationMarker.setMap(null);
  originMarker = null; destinationMarker = null;
  directionsRenderer.setDirections({ routes: [] });
  const o = document.getElementById("origen");
  const d = document.getElementById("destino");
  if (o) o.value = "";
  if (d) d.value = "";
  window.distanciaKm = 0;
  const distEl = document.getElementById("distanciaRuta");
  if (distEl) distEl.textContent = "Distancia de la ruta: 0.0 km";
  const durEl = document.getElementById("duracionRuta");
  if (durEl) durEl.textContent = "Duraci√≥n estimada ruta: 0 min";
}

// -------------------- L√ìGICA DE PESO / PEONES / COSTES --------------------
function calcularPeso() {
  const n = id => parseInt(document.getElementById(id)?.value) || 0;
  const manual = parseInt(document.getElementById('pesoManual')?.value) || 0;
  if (manual > 0) return manual;
  return n('armarios')*60 + n('cajas')*15 + n('bultos')*20 + n('sofas')*50 + n('camaMatrimonio')*80 + n('camaIndividual')*50;
}

function getPesoIncluido(ambasDentro, tipo){
  if (tipo === 'porteSolo')   return ambasDentro ? 350 : 250;
  if (tipo === 'porteCD')     return ambasDentro ? 250 : 200;
  if (tipo === 'mudanza')     return ambasDentro ? 200 : 150;
  if (tipo === 'vaciado')     return ambasDentro ? 220 : 170;
  return ambasDentro ? 250 : 200;
}

function kmRateExtraPorExceso(excesoKg){
  if (excesoKg <= 0) return 0;
  if (excesoKg <= 200) return 0.10;
  if (excesoKg <= 400) return 0.20;
  return 0.35;
}
function extraFijoPorExceso(excesoKg){
  if (excesoKg <= 0) return 0;
  if (excesoKg <= 300) return 5;
  if (excesoKg <= 600) return 12;
  return 20;
}
function recargoManejoPorExceso(excesoKg){
  if (excesoKg <= 0) return 0;
  if (excesoKg <= 300) return 20;
  if (excesoKg <= 600) return 40;
  return 60;
}
function estimarMinutosManejo(){
  const g = id => parseInt(document.getElementById(id)?.value) || 0;
  const min = g('cajas')*3 + g('bultos')*4 + g('armarios')*10 + g('sofas')*8 + g('camaMatrimonio')*12 + g('camaIndividual')*10;
  return Math.max(min, (min>0 ? 15 : 0));
}
function peonesRecomendados(peso){
  const g = id => parseInt(document.getElementById(id)?.value) || 0;
  const voluminosos = g('sofas') + g('camaMatrimonio') + g('camaIndividual') + g('armarios');
  if (peso > 450 || voluminosos >= 2) return 2;
  return 1;
}

function actualizarPrecio() {
  const sel = Array.from(document.querySelectorAll('.option'))
    .filter(op => op.checked)
    .map(op => (op.dataset.name||'').toLowerCase());

  const isPorteSolo   = sel.includes('porte (solo transporte)') || sel.includes('porte local (ayuda pie de calle)');
  const isPorteCD     = sel.includes('porte con carga y descarga') || sel.includes('carga y descarga adicional');
  const isMudanza     = sel.includes('mudanza peque√±a');
  const isVaciado     = sel.includes('vaciado de piso') || sel.includes('vaciado de nave');

  let base = 0;
  document.querySelectorAll('.option').forEach(op => { if (op.checked) base += parseFloat(op.dataset.price)||0; });

  let kmRateBase = 1.2;
  let ambasDentro = false;
  if (originMarker && destinationMarker) {
    const dentroA = insideSevilla(originMarker.getPosition());
    const dentroB = insideSevilla(destinationMarker.getPosition());
    ambasDentro = (dentroA && dentroB);
    if (ambasDentro) kmRateBase = 0.9;
  }

  const km = Math.max(0, window.distanciaKm || 0);
  const peso = calcularPeso();

  let tipo = 'porteSolo';
  if (isMudanza) tipo = 'mudanza';
  else if (isVaciado) tipo = 'vaciado';
  else if (isPorteCD) tipo = 'porteCD';
  else if (isPorteSolo) tipo = 'porteSolo';

  const pesoIncluido = getPesoIncluido(ambasDentro, tipo);
  const excesoKg = Math.max(0, peso - pesoIncluido);

  const kmExtra = kmRateExtraPorExceso(excesoKg);
  const fijoComb = extraFijoPorExceso(excesoKg);

  const kmRate = kmRateBase + kmExtra;
  const kmCost = km * kmRate;

  const manejoRequerido = (isPorteCD || isMudanza || isVaciado);
  let manejoPeso = 0, peones = 0, minManejo = 0, costePeones = 0;

  if (manejoRequerido){
    manejoPeso = recargoManejoPorExceso(excesoKg);
    minManejo = estimarMinutosManejo();
    peones = peonesRecomendados(peso);
    const tarifaPeonHora = 18;
    const horas = minManejo / 60;
    costePeones = peones * tarifaPeonHora * horas;
  }

  let total = base + kmCost + fijoComb + manejoPeso + costePeones;

  if (ambasDentro && total < 35) total = 35;

  const pesoEl = document.getElementById("pesoTotal");
  if (pesoEl) pesoEl.textContent = `Peso estimado: ${peso} kg`;
  const precioEl = document.getElementById("precioTotal");
  if (precioEl) precioEl.textContent = `Precio estimado: ${total.toFixed(2)} ‚Ç¨`;

  const desgloseTxt = [
    `Base servicios: ${base.toFixed(2)} ‚Ç¨`,
    `Km (${kmRate.toFixed(2)} ‚Ç¨/km): ${kmCost.toFixed(2)} ‚Ç¨`,
    fijoComb ? `Extra combustible (exceso ${excesoKg} kg): ${fijoComb.toFixed(2)} ‚Ç¨` : null,
    (manejoRequerido && manejoPeso) ? `Manejo por exceso: ${manejoPeso.toFixed(2)} ‚Ç¨` : null,
    (manejoRequerido && costePeones) ? `Peones (${peones}) ¬∑ ${Math.round(minManejo)} min: ${costePeones.toFixed(2)} ‚Ç¨` : null,
    ambasDentro ? `M√≠nimo Sevilla capital aplicado si procede` : null
  ].filter(Boolean).join(" ¬∑ ");
  const desg = document.getElementById("desglose");
  if (desg) desg.textContent = desgloseTxt;

  const man = document.getElementById("manejo");
  if (man) man.textContent = manejoRequerido ? `Carga/descarga: ${Math.round(minManejo)} min ¬∑ Peones: ${peones}` : `Carga/descarga: ‚Äî ¬∑ Peones: ‚Äî`;
}

function enviarSolicitud() {
  const nombre = document.getElementById('nombre')?.value.trim() || "";
  const telefono = document.getElementById('telefono')?.value.trim() || "";
  const origen = document.getElementById('origen')?.value.trim() || "";
  const destino = document.getElementById('destino')?.value.trim() || "";
  const notas = document.getElementById('notas')?.value.trim() || "";

  if (!nombre || !telefono || !origen || !destino) {
    alert("Por favor, completa nombre, WhatsApp, origen y destino.");
    return;
  }

  const precio = document.getElementById('precioTotal')?.textContent || "";
  const peso = document.getElementById('pesoTotal')?.textContent || "";
  const distancia = document.getElementById('distanciaRuta')?.textContent || "";
  const duracion = document.getElementById('duracionRuta')?.textContent || "";
  const manejo = document.getElementById('manejo')?.textContent || "";

  let mensaje = `Presupuesto pedido por ${nombre}%0A`;
  mensaje += `Tel√©fono: ${telefono}%0A`;
  mensaje += `Origen: ${origen}%0ADestino: ${destino}%0A`;
  if (distancia) mensaje += `${distancia}%0A`;
  if (duracion)  mensaje += `${duracion}%0A`;
  if (peso)      mensaje += `${peso}%0A`;
  if (manejo)    mensaje += `${manejo}%0A`;
  if (precio)    mensaje += `${precio}%0A`;
  mensaje += `Notas: ${notas || 'Ninguna'}%0A`;
  mensaje += `‚ö†Ô∏è Precio orientativo; se confirma en el presupuesto oficial seg√∫n tiempo y peso.`;

  const numeroWhatsApp = '34698373471';
  const urlWhatsapp = `https://wa.me/${numeroWhatsApp}?text=${mensaje}`;
  window.open(urlWhatsapp, '_blank');

  abrirModal();
}

// Modal
function abrirModal(){ const m=document.getElementById('modal'); if(!m) return; m.style.display='flex'; m.setAttribute('aria-hidden','false'); }
function cerrarModal(){ const m=document.getElementById('modal'); if(!m) return; m.style.display='none'; m.setAttribute('aria-hidden','true'); }
document.addEventListener('keydown', e=>{ if(e.key==='Escape') cerrarModal(); });
document.addEventListener('click', e=>{ const m=document.getElementById('modal'); if(!m||m.style.display==='none') return; if(e.target===m) cerrarModal(); });

// Recalcular una vez cargado el DOM
document.addEventListener('DOMContentLoaded', actualizarPrecio);

// ‚úÖ Asegurar que Google encuentre el callback
window.initMap = initMap;
</script>

  <!-- Google Maps API (incluye geometry para el c√≠rculo y la distancia) -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDVPHqQDXL4vVijvq2vg3KeGKwgR-VDgu8&libraries=geometry&callback=initMap" async defer></script>
</body>
</html>
